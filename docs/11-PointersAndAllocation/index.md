#  ポインタと動的メモリ確保
C言語勉強会 第十一回

kumar  
July 10, 2013  
[引用 : Programming Place Plus](http://www.geocities.jp/ky_webid/index.html)

----
### 今回の内容

* 構造体へのポインタ
	* アロー演算子
* constポインタ
	* 間接参照先への代入を禁止
* 動的メモリ確保
	* 可変長な配列を実現できる

## 構造体へのポインタ

----
### 構造体へのポインタ

メンバにアクセスするには、アロー演算子`->`を使う。

#### 文法
	構造体へのポインタ->メンバ名

#### 例1
ps を構造体 S へのポインタとし、構造体 S は x, y をメンバに持つとする。
	
stの 間接参照先（指し示す先）の x へアクセスする。

	ps->x

----
#### 例2
構造体Humanへのポインタを引数にとる関数。Humanのメンバはchar name[20], int height, int weightとする。

	void printHuman(Human *p) {
		printf("名前: %s", p->name);
		printf(" 身長: %d", p->height);
		printf(" 体重: %d¥n", p->weight);
	}

----
### アロー演算子は糖衣構文

アロー演算子も配列の添字と同じく、糖衣構文（シンタックスシュガー）である。

#### 文法

	ps->x

におけるアロー演算子は

	(*ps).x

の糖衣構文（シンタックスシュガー）である

----
## constポインタ

----
### constポインタでできること

<small>constポインタを一切使わなくても同じプログラムを書けるが、</small>ミスが減る

----
### おさらい｜const変数

> 指定した変数が定数であることを指定する。  
> 定数とは、初期化出来ても書き換え出来ない変数のことである。
>
> #### 文法
> 	const 型名 変数名;
>	または
>	型名 const 変数名;


----
### constポインタ

そのポインタから間接参照先を書き換えることを禁じる

#### 文法
	const 型 *変数名
	または
	型 const *変数名

----
#### 例
int 型変数 x が宣言されているとする。

	const int *cp = &x;	/* constポインタを宣言 */
	int *p = &x;
	
	int foo = 10 + *cp;	/* 可能 */
	*p = 100; 			/* 可能 */
	
	*px = 5;			/* 不可能。コンパイルエラー */
	
* constポインタ cp からの書き換え __のみが不可能__
	* cp でも読み込みは可能。	

----
### constポインタでできること
	
ミスが減る。特に配列を<small>（ポインタにして）</small>引数にとる関数を書く際に、配列を誤って書き換えることがない

#### 例
constポインタを引数にとる関数の例

	int strlen(const char *str) {
		int len = 0;
		while(str++ != '¥0')
			len++;
		return len;
	}

* この関数は引数にとった文字列の長さを返す関数である。よって、引数 str を書き換えることはない。この関数を書いた人は、誤って引数 str を書き換えてしまうプログラムを書いてしまうミスを防ぐため、char *strにconstをつけた。
	

----
## コラム

----
### （前置｜後置）（イン｜デ）クリメント
インクリメントやデクリメントは、演算子を変数名の前に書くか後ろに書くかで名前、性質が変わる。

#### 文法
vを何らかの変数とする。

<table>
	<tr>
		<td>++v</td><td>前置インクリメント</td>
	</tr>
	<tr>
		<td>--v</td><td>前置デクリメント</td>
	</tr>
	<tr>
		<td>v++</td><td>後置インクリメント</td>
	</tr>
	<tr>
		<td>v--</td><td>後置デクリメント</td>
	</tr>
</table>

----
御存知の通り、インクリメントは「変数に１足す」という意味で、デクリメントは「変数から１引く」という意味である。だが、演算子が前置か後置かで、式の中で演算が行われるタイミングが異なる。

#### 前置（イン｜デ）クリメント
式


----
### ポインタの複数宣言
ポインタを一行で一度に宣言するとき、

	int *x, y, z;
	
と書きたくなるかと思うが、こう書くと、xだけがポインタになり、yとzは通常の変数になってしまう。正しくは

	int *x, *y, *z;
	
こう書くのが正しい。

----
### ポインタとconst修飾子
以下の例はconstポインタの宣言の文法である

	const int *x;
	int const *x;
	
だが以下の例はそうではない。

	int *const x: 

* こう書くと、xの関節参照先ではなく、xそのものを書き換えできなくなる。（つまり、初期化のあとでの`x = &y;`はコンパイルエラーとなる。）

----
## 動的メモリ確保

----
### 動的メモリ確保

----
### malloc()

----
### free()

----
### calloc()

----
### realloc()

----
## 次回

----
### 次回予告（多分最終回）

* ファイル入出力
